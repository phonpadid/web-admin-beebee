import{_ as te}from"./nodata-b6ZJ5XC7.js";import{r as re}from"./role.store-CX8tLYic.js";import{u as oe}from"./index-9lTxRn36.js";import{u as ne}from"./index-OvwLZKPx.js";import{p as ue}from"./permissions.store-1L6rt9_s.js";import{u as ie}from"./update-user.schema-BBUVuOA1.js";import{d as me,r as m,u as de,k as pe,m as ce,l as fe,v as ve,o as n,f as d,g as f,h as C,c as o,j as v,t as u,n as h,i as t,F as B,e as p,a as _e,E as he,q as y,p as j,x as F,s as I}from"./index-BpXBQnxn.js";import"./axios.config-9RTEzkkw.js";import"./user.schema-CzutrDlL.js";const ge={class:"pb-4 flex justify-between"},be={class:"text-base font-bold text-blue-500 flex items-center gap-1"},ye={class:"flex flex-col items-center sm:items-start gap-6"},ke={key:1,src:te,width:"200rem",height:"200rem",class:"my-4",style:{"object-fit":"contain"},alt:""},xe={class:"md:flex md:flex-row flex-col gap-4"},we={key:0,class:"text-red-500"},$e={key:0,class:"text-red-500"},Ue={class:"md:flex md:flex-row flex-col gap-4"},Se={key:0,class:"text-red-500"},Ce={key:0,class:"text-red-500"},je={key:1,class:"text-red-500"},Be={key:0},Ne={key:0},Ae={class:"md:flex md:flex-row flex-col mt-4"},Ke={class:"md:flex md:flex-row flex-col gap-4"},qe=me({__name:"GetMeView",props:{searchQuery:{type:String,default:null}},setup(Ee){const b=m(null),{schema:q,schemaKey:Q}=ie(),k=m(""),{push:T}=_e();function G(e){return e.size>5242880?(k.value="ຂະໜາດຮູບຕ້ອງບໍ່ເກີນ 5MB",!1):(k.value="",b.value&&URL.revokeObjectURL(b.value),b.value=URL.createObjectURL(e),s.value.avatar=e,!1)}const H=()=>{s.value.avatar=void 0,b.value=""},{state:J,getAll:W}=re(),{statePermission:X,getAllPer:Y}=ue(),{update:Z}=oe(),{stateGetMe:x}=ne(),N=m(null),D=m(!1),s=m({id:"",first_name:"",last_name:"",type:"",phone_number:"",groups:[],is_active:!1,is_superuser:!1,is_staff:!1,user_permissions:[],avatar:void 0,email:""}),{t:_}=de(),$=pe(()=>({firstName:_("placeholder.user.fname"),lastName:_("placeholder.user.lname"),phoneNumber:_("placeholder.user.phone_number"),email:_("placeholder.user.email"),password:_("placeholder.user.password"),confirmPassword:_("placeholder.user.confirm_password")})),A=m(),K=m(!0),E=m(!0),L=m(["1"]),z=m(["1"]),M=m([]),R=m([]),i=ce({}),ee=async()=>{A.value.validate().then(async()=>{try{D.value=!0,await Z(s.value,s.value.id),I.success({message:_("messages.success"),description:_("messages.update")})}catch(e){if(e.response&&e.response.data){const a=e.response.data||{};Object.keys(a).forEach(c=>{i[c]=Array(a[c])?a[c][0]:""})}}}).catch(e=>{e.status===403&&I.warn({message:"ເຕືອນ",description:"ທ່ານບໍ່ມີສິດແກ້ໄຂ"})})},ae=async()=>{var e,a,c,U;try{if(await W(),M.value=((a=(e=J.data)==null?void 0:e.props)==null?void 0:a.map(r=>({id:r.id,name:r.name})))||[],K.value=!1,await Y(),R.value=((U=(c=X.data)==null?void 0:c.props)==null?void 0:U.map(r=>({id:r.id,name:r.name})))||[],E.value=!1,x!=null&&x.data){const r=x.data;s.value={...r,is_staff:!!r.is_staff,groups:Array.isArray(r.groups)?r.groups.map(g=>g.id):[],user_permissions:Array.isArray(r.user_permissions)?r.user_permissions.map(g=>g.id):[]},N.value=r.avatar||null}}catch(r){console.error("Error populating user form:",r)}};return fe(()=>x.data,e=>{e&&(s.value={...s.value,id:e.id||"",first_name:e.first_name||"",last_name:e.last_name||"",phone_number:e.phone_number||"",email:e.email||"",is_superuser:e.is_superuser||"",is_active:e.is_active||"",is_staff:e.email||"",groups:e.groups.map(a=>a.id)||[],user_permissions:e.user_permissions.map(a=>a.id)||[],avatar:e.avatar||""},N.value=e.avatar||"")},{immediate:!0}),ve(async()=>{await ae()}),(e,a)=>{const c=p("a-image"),U=p("a-alert"),r=p("a-form-item"),g=p("a-button"),se=p("a-upload"),S=p("a-input"),w=p("a-checkbox"),P=p("a-checkbox-group"),O=p("a-collapse-panel"),V=p("a-collapse"),le=p("a-form");return n(),d(B,null,[f("div",ge,[f("p",be,[f("span",{onClick:a[0]||(a[0]=l=>C(T)({name:"admin_dashboard"})),class:"hover:ring-red-300 text-[12px] w-10 h-6 ring-1 ring-slate-300 rounded-sm flex items-center justify-center outline-none"},[o(C(he))]),v(" "+u(e.$t("me.detail")),1)])]),(n(),h(le,{layout:"vertical",ref_key:"form",ref:A,rules:C(q),key:C(Q),model:s.value,class:"flex-col flex"},{default:t(()=>[o(r,{label:" ",class:"-mt-12",name:"avatar"},{default:t(()=>[f("div",ye,[b.value||s.value.avatar?(n(),h(c,{key:0,src:b.value||s.value.avatar,width:"10rem",height:"10rem",style:{"object-fit":"contain"}},{previewMask:t(()=>[f("span",null,u(e.$t("preview")),1)]),_:1},8,["src"])):(n(),d("img",ke)),k.value?(n(),h(U,{key:2,message:k.value,type:"error",banner:"",closable:"",onClose:a[1]||(a[1]=l=>k.value="")},null,8,["message"])):y("",!0)])]),_:1}),o(r,{class:"-mt-12",label:" "},{default:t(()=>[o(se,{showUploadList:!1,accept:".png, .jpeg, .jpg",multiple:"","before-upload":G},{default:t(()=>[o(g,null,{default:t(()=>[v(u(e.$t("customers.table_field.choose_profile")),1)]),_:1})]),_:1}),s.value.avatar?(n(),h(g,{key:0,onClick:H,class:"ml-4 text-red-600"},{default:t(()=>[v(u(e.$t("customers.table_field.btn.remove")),1)]),_:1})):y("",!0)]),_:1}),f("div",xe,[o(r,{label:e.$t("users.table_field.fname"),name:"first_name",class:"w-full"},{default:t(()=>[o(S,{placeholder:$.value.firstName,class:j(["h-12",{"ring-1 ring-red-500 mb-1":i.first_name&&s.value.first_name.length>149}]),value:s.value.first_name,"onUpdate:value":a[2]||(a[2]=l=>s.value.first_name=l)},null,8,["placeholder","class","value"]),i.first_name&&s.value.first_name.length>149?(n(),d("span",we,u(e.$t("validation.user.length_name")),1)):y("",!0)]),_:1},8,["label"]),o(r,{label:e.$t("users.table_field.lname"),name:"last_name",class:"w-full"},{default:t(()=>[o(S,{placeholder:$.value.lastName,class:j(["h-12",{"ring-1 ring-red-500 mb-1":i.last_name&&s.value.last_name.length>149}]),value:s.value.last_name,"onUpdate:value":a[3]||(a[3]=l=>s.value.last_name=l)},null,8,["placeholder","class","value"]),i.last_name&&s.value.last_name.length>149?(n(),d("span",$e,u(e.$t("validation.user.length_name")),1)):y("",!0)]),_:1},8,["label"])]),f("div",Ue,[o(r,{label:e.$t("users.table_field.phone_number"),name:"phone_number",class:"w-full"},{default:t(()=>[o(S,{placeholder:$.value.phoneNumber,class:j(["h-12",{"ring-1 ring-red-500 mb-1":i.phone_number&&s.value.phone_number.length>11}]),value:s.value.phone_number,"onUpdate:value":a[4]||(a[4]=l=>s.value.phone_number=l)},null,8,["placeholder","class","value"]),i.phone_number&&s.value.phone_number.length>11?(n(),d("span",Se,u(e.$t("validation.user.length_phone")),1)):y("",!0)]),_:1},8,["label"]),o(r,{label:e.$t("users.table_field.email"),name:"email",class:"w-full"},{default:t(()=>[o(S,{placeholder:$.value.email,class:j(["h-12",{"ring-1 ring-red-500 mb-1":i.email&&s.value.email.length>254||i.email==="user with this email address already exists."||i.email==="Enter a valid email address."}]),value:s.value.email,"onUpdate:value":a[5]||(a[5]=l=>s.value.email=l)},null,8,["placeholder","class","value"]),i.email&&s.value.email.length>254?(n(),d("span",Ce,u(e.$t("validation.user.email_length")),1)):i.email&&i.email==="user with this email address already exists."?(n(),d("span",je,u(e.$t("validation.user.email_exits")),1)):y("",!0)]),_:1},8,["label"])]),o(V,{activeKey:L.value,"onUpdate:activeKey":a[7]||(a[7]=l=>L.value=l),class:"mt-2"},{default:t(()=>[o(O,{key:"1",header:e.$t("users.table_field.get_roles"),name:"groups",class:"w-full"},{default:t(()=>[K.value?(n(),d("div",Be,"ບໍ່ມີບົດບາດ...")):(n(),h(P,{key:1,value:s.value.groups,"onUpdate:value":a[6]||(a[6]=l=>s.value.groups=l),class:"flex flex-wrap gap-4"},{default:t(()=>[(n(!0),d(B,null,F(M.value,l=>(n(),h(w,{key:l.id,value:l.id},{default:t(()=>[v(u(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]))]),_:1},8,["header"])]),_:1},8,["activeKey"]),o(V,{activeKey:z.value,"onUpdate:activeKey":a[9]||(a[9]=l=>z.value=l),class:"mt-8"},{default:t(()=>[o(O,{key:"1",header:e.$t("users.table_field.get_permissions"),name:"user_permission",class:"w-full"},{default:t(()=>[E.value?(n(),d("div",Ne,"ບໍ່ມີສິດທີ່")):(n(),h(P,{key:1,value:s.value.user_permissions,"onUpdate:value":a[8]||(a[8]=l=>s.value.user_permissions=l),class:"flex flex-wrap gap-4"},{default:t(()=>[(n(!0),d(B,null,F(R.value,l=>(n(),h(w,{key:l.id,value:l.id},{default:t(()=>[v(u(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]))]),_:1},8,["header"])]),_:1},8,["activeKey"]),f("div",Ae,[o(r,{label:"",name:"is_superuser",class:"md:w-[10rem]"},{default:t(()=>[o(w,{checked:s.value.is_superuser,onChange:a[10]||(a[10]=l=>s.value.is_superuser=l.target.checked)},{default:t(()=>[v(u(e.$t("users.table_field.super_user")),1)]),_:1},8,["checked"])]),_:1}),o(r,{label:"",name:"is_staff",class:"md:w-[10rem]"},{default:t(()=>[o(w,{checked:!!s.value.is_staff,onChange:a[11]||(a[11]=l=>s.value.is_staff=l.target.checked)},{default:t(()=>[v(u(e.$t("users.table_field.staff")),1)]),_:1},8,["checked"])]),_:1}),o(r,{label:"",name:"is_active",class:"md:w-[10rem]"},{default:t(()=>[o(w,{checked:s.value.is_active,onChange:a[12]||(a[12]=l=>s.value.is_active=l.target.checked)},{default:t(()=>[v(u(e.$t("users.table_field.status")),1)]),_:1},8,["checked"])]),_:1})]),f("div",Ke,[o(r,{class:"flex items-center mt-4 justify-center"},{default:t(()=>[o(g,{type:"primary",onClick:ee},{default:t(()=>[v(u(e.$t("me.btn")),1)]),_:1})]),_:1})])]),_:1},8,["rules","model"]))],64)}}});export{qe as default};
