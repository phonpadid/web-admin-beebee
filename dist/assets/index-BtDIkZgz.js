import{i as _,a as l,A as y,b as O}from"./axios.config-9RTEzkkw.js";import{z as S,a as j,m as d,B as f}from"./index-DmLjb2yN.js";var M=Object.defineProperty,$=Object.getOwnPropertyDescriptor,b=(s,e,a,t)=>{for(var r=t>1?void 0:t?$(e,a):e,o=s.length-1,n;o>=0;o--)(n=s[o])&&(r=(t?n(e,a,r):n(r))||r);return t&&r&&M(e,a,r),r},x=(s,e)=>(a,t)=>e(a,t,s);let u=class{constructor(s){this._api=s}async login(s){return{data:(await this._api.axios({method:"post",url:"/auth/login/",data:{email:s.email,password:s.password}})).data,message:"ເຂົ້າສູ່ລະບົບສຳເລັດແລ້ວ",status:"success"}}async showMe(){return{data:(await this._api.axios({url:"/auth/me/"})).data,status:"success"}}async changePassword(s){return{data:(await this._api.axios({method:"put",url:`/auth/change-password/${s.id}`,data:{old_password:s.old_password,new_password:s.new_password}})).data,message:"ອັບເດດສຳເລັດ",status:"success"}}};u=b([_(),x(0,l(y))],u);var L=Object.defineProperty,A=Object.getOwnPropertyDescriptor,D=(s,e,a,t)=>{for(var r=t>1?void 0:t?A(e,a):e,o=s.length-1,n;o>=0;o--)(n=s[o])&&(r=(t?n(e,a,r):n(r))||r);return t&&r&&L(e,a,r),r},I=(s,e)=>(a,t)=>e(a,t,s);let h=class{constructor(s){this._api=s}async execute(s){return await this._api.login(s)}};h=D([_(),I(0,l(u))],h);var R=Object.defineProperty,C=Object.getOwnPropertyDescriptor,J=(s,e,a,t)=>{for(var r=t>1?void 0:t?C(e,a):e,o=s.length-1,n;o>=0;o--)(n=s[o])&&(r=(t?n(e,a,r):n(r))||r);return t&&r&&R(e,a,r),r},v=(s,e)=>(a,t)=>e(a,t,s);let g=class{constructor(s,e){this._login=s,this._authReposioty=e}async login(s){return await this._login.execute(s)}async showMe(){return await this._authReposioty.showMe()}async changePassowrd(s){return await this._authReposioty.changePassword(s)}};g=J([_(),v(0,l(h)),v(1,l(u))],g);const z=S("auth",()=>{const s=j(),e=O.resolve(g),a=d({data:null,isLoading:!1,errorMessage:""});let t=d({email:"",password:""});async function r(c){try{a.isLoading=!0;const i=await e.login(c);i.status==="success"&&i.data?(localStorage.setItem("access",i.data.access),localStorage.setItem("roles",JSON.stringify(i.data.roles)),localStorage.setItem("permissions",JSON.stringify(i.data.permissions)),f.success({content:"ຍີນດີຕ້ອນຮັບເຂົ້າສູ່ລະບົບ.",duration:3}),s.push({name:"admin_dashboard"}),m()):(console.log("errMessage:"),a.errorMessage=i.message?i.message:"")}catch(i){let p="";i.response.status===422?p=Object.keys(i.response.data.errors).map(w=>`${w}: ${i.response.data.errors[w].join(", ")}`).join("; "):i.status===401?(a.errorMessage="ອີເມວ ຫຼື ລະຫັດຜ່ານບໍ່ຖືກຕ້ອງ.",a.isLoading=!1,f.error({content:"ອີເມວ ຫຼື ລະຫັດຜ່ານບໍ່ຖືກຕ້ອງ.",duration:3})):p=i.response.data.error,a.errorMessage=p}a.isLoading=!1}async function o(){localStorage.removeItem("access"),localStorage.removeItem("roles"),localStorage.removeItem("permissions"),s.push({name:"login"})}async function n(){a.isLoading=!0;const c=await e.showMe();c&&c.data&&c.status==="success"&&(a.data=c.data,a.isLoading=!1)}async function P(c){return await e.changePassowrd(c)}function m(){t=d({email:"",password:""})}return{stateGetMe:a,form:t,login:r,logout:o,showMe:n,changePassword:P,clearFormUser:m}});export{z as u};
