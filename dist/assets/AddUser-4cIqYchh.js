import{_ as oe}from"./nodata-b6ZJ5XC7.js";import{r as ne}from"./role.store-CX8tLYic.js";import{u as re}from"./index-9lTxRn36.js";import{d as ue,r as m,m as ie,u as me,k as de,v as pe,o as n,f as d,g as c,h as k,c as t,j as _,t as u,n as h,i as o,F as L,e as i,a as ce,E as ve,q as w,p as U,x as V,s as D,_ as fe}from"./index-BpXBQnxn.js";import{u as _e}from"./user.schema-CzutrDlL.js";import{p as he}from"./permissions.store-1L6rt9_s.js";import"./axios.config-9RTEzkkw.js";const ge={class:"pb-4 flex justify-between"},be={class:"text-base font-bold text-blue-500 flex items-center gap-1"},we={class:"flex flex-col items-center sm:items-start gap-6"},ye={key:1,src:oe,width:"200rem",height:"200rem",class:"my-4",style:{"object-fit":"contain"},alt:"",srcset:""},ke={class:"md:flex md:flex-row flex-col gap-4"},xe={key:0,class:"text-red-500"},$e={key:0,class:"text-red-500"},Ue={class:"md:flex md:flex-row flex-col gap-4"},Se={key:0,class:"text-red-500"},je={key:0,class:"text-red-500"},Le={key:1,class:"text-red-500"},Be={class:"md:flex md:flex-row flex-col gap-4"},Ce={style:{color:"red"}},Ne={key:0},Ke={key:0},Re={class:"md:flex md:flex-row flex-col gap-4"},Pe=ue({__name:"AddUser",props:{searchQuery:{type:String,default:null}},setup(ze){const{schema:T,schemaKey:q}=_e(),{push:S}=ce(),{state:Q,getAll:B}=ne(),{statePermission:G,getAllPer:H}=he(),f=m(null),y=m(""),{create:J}=re(),r=ie({}),C={id:"",first_name:"",last_name:"",type:"",phone_number:"",groups:[],user_permissions:[],avatar:void 0,email:"",password:"",password_confirmation:""},{t:p}=me(),g=de(()=>({firstName:p("placeholder.user.fname"),lastName:p("placeholder.user.lname"),phoneNumber:p("placeholder.user.phone_number"),email:p("placeholder.user.email"),password:p("placeholder.user.password"),confirmPassword:p("placeholder.user.confirm_password")})),N=m(),K=m(!1),l=m({...C}),W=()=>{l.value={...C}},X=async()=>{N.value.validate().then(async()=>{K.value=!0;try{l.value.password===l.value.password_confirmation?(await new Promise(e=>setTimeout(e,1e3)),await J(l.value),D.success({message:p("messages.success"),description:p("messages.description")}),W(),K.value=!1,S({name:"user"}),await B()):D.warn({message:p("messages.error"),description:p("validation.change_password.password_no_match")})}catch(e){if(e.response&&e.response.data){const a=e.response.data||{};Object.keys(a).forEach(b=>{r[b]=Array(a[b])?a[b][0]:""})}}})},R=m([]),P=m([]),j=m(!0),Y=m(!0);function Z(e){return e.size>5242880?(y.value="ຂະໜາດຮູບຕ້ອງບໍ່ເກີນ 5MB",!1):(y.value="",f.value&&URL.revokeObjectURL(f.value),f.value=URL.createObjectURL(e),l.value.avatar=e,!1)}const ee=()=>{f.value&&(URL.revokeObjectURL(f.value),f.value=null),l.value.avatar=void 0},ae=e=>{r[e]=""};pe(async()=>{await B(),R.value=Q.data.props.map(e=>({id:e.id,name:e.name})),j.value=!1,await H(),P.value=G.data.props.map(e=>({id:e.id,name:e.name})),Y.value=!1});const z=m(["2"]),E=m(["2"]);return(e,a)=>{const b=i("a-image"),se=i("a-alert"),v=i("a-form-item"),x=i("a-button"),le=i("a-upload"),$=i("a-input"),M=i("a-input-password"),A=i("a-checkbox"),O=i("a-checkbox-group"),F=i("a-collapse-panel"),I=i("a-collapse"),te=i("a-form");return n(),d(L,null,[c("div",ge,[c("p",be,[c("span",{onClick:a[0]||(a[0]=s=>k(S)({name:"user"})),class:"hover:ring-red-300 text-[12px] w-10 h-6 ring-1 ring-slate-300 rounded-sm flex items-center justify-center outline-none"},[t(k(ve))]),_(" "+u(e.$t("users.form_update")),1)])]),(n(),h(te,{layout:"vertical",ref_key:"form",ref:N,rules:k(T),key:k(q),model:l.value,class:"flex-col flex"},{default:o(()=>[t(v,{label:" ",class:"-mt-12",name:"avatar"},{default:o(()=>[c("div",we,[f.value?(n(),h(b,{key:0,src:f.value,width:"10rem",height:"10rem",style:{"object-fit":"contain"}},{previewMask:o(()=>[c("span",null,u(e.$t("preview")),1)]),_:1},8,["src"])):(n(),d("img",ye)),y.value?(n(),h(se,{key:2,message:y.value,type:"error",banner:"",closable:"",onClose:a[1]||(a[1]=s=>y.value="")},null,8,["message"])):w("",!0)])]),_:1}),t(v,{class:"-mt-12",label:" "},{default:o(()=>[t(le,{showUploadList:!1,accept:".png, .jpeg, .jpg",multiple:"","before-upload":Z},{default:o(()=>[t(x,null,{default:o(()=>[_(u(e.$t("customers.table_field.choose_profile")),1)]),_:1})]),_:1}),l.value.avatar?(n(),h(x,{key:0,onClick:ee,class:"ml-4 text-red-600"},{default:o(()=>[_(u(e.$t("customers.table_field.btn.remove")),1)]),_:1})):w("",!0)]),_:1}),c("div",ke,[t(v,{label:e.$t("users.table_field.fname"),name:"first_name",class:"w-full"},{default:o(()=>[t($,{placeholder:g.value.firstName,class:U(["h-12",{"ring-1 ring-red-500 mb-1":r.first_name&&l.value.first_name.length>149}]),value:l.value.first_name,"onUpdate:value":a[2]||(a[2]=s=>l.value.first_name=s)},null,8,["placeholder","class","value"]),r.first_name&&l.value.first_name.length>149?(n(),d("span",xe,u(e.$t("validation.user.length_name")),1)):w("",!0)]),_:1},8,["label"]),t(v,{label:e.$t("users.table_field.lname"),name:"last_name",class:"w-full"},{default:o(()=>[t($,{placeholder:g.value.lastName,class:U(["h-12",{"ring-1 ring-red-500 mb-1":r.last_name&&l.value.last_name.length>149}]),value:l.value.last_name,"onUpdate:value":a[3]||(a[3]=s=>l.value.last_name=s)},null,8,["placeholder","class","value"]),r.last_name&&l.value.last_name.length>149?(n(),d("span",$e,u(e.$t("validation.user.length_name")),1)):w("",!0)]),_:1},8,["label"])]),c("div",Ue,[t(v,{label:e.$t("users.table_field.phone_number"),name:"phone_number",class:"w-full"},{default:o(()=>[t($,{placeholder:g.value.phoneNumber,class:U(["h-12",{"ring-1 ring-red-500 mb-1":r.phone_number&&l.value.phone_number.length>11}]),value:l.value.phone_number,"onUpdate:value":a[4]||(a[4]=s=>l.value.phone_number=s)},null,8,["placeholder","class","value"]),r.phone_number&&l.value.phone_number.length>11?(n(),d("span",Se,u(e.$t("validation.user.length_phone")),1)):w("",!0)]),_:1},8,["label"]),t(v,{label:e.$t("users.table_field.email"),name:"email",class:"w-full"},{default:o(()=>[t($,{placeholder:g.value.email,class:U(["h-12",{"ring-1 ring-red-500 mb-1":r.email&&l.value.email.length>254||r.email==="user with this email address already exists."||r.email==="Enter a valid email address."}]),value:l.value.email,"onUpdate:value":a[5]||(a[5]=s=>l.value.email=s)},null,8,["placeholder","class","value"]),r.email&&l.value.email.length>254?(n(),d("span",je,u(e.$t("validation.user.email_length")),1)):r.email&&r.email==="user with this email address already exists."?(n(),d("span",Le,u(e.$t("validation.user.email_exits")),1)):w("",!0)]),_:1},8,["label"])]),c("div",Be,[t(v,{label:e.$t("users.table_field.password"),name:"password",class:"w-full"},{default:o(()=>[t(M,{type:"password",placeholder:g.value.password,class:"h-12",value:l.value.password,"onUpdate:value":a[6]||(a[6]=s=>l.value.password=s),onInput:a[7]||(a[7]=s=>ae("password"))},null,8,["placeholder","value"]),c("span",Ce,u(r.password),1)]),_:1},8,["label"]),t(v,{label:e.$t("users.table_field.confirm_password"),name:"password_confirmation",class:"w-full"},{default:o(()=>[t(M,{type:"password",placeholder:g.value.confirmPassword,class:"h-12",value:l.value.password_confirmation,"onUpdate:value":a[8]||(a[8]=s=>l.value.password_confirmation=s)},null,8,["placeholder","value"])]),_:1},8,["label"])]),t(I,{activeKey:z.value,"onUpdate:activeKey":a[10]||(a[10]=s=>z.value=s),class:"mt-2"},{default:o(()=>[t(F,{key:"2",header:e.$t("users.table_field.get_roles"),name:"groups",class:"w-full"},{default:o(()=>[j.value?(n(),d("div",Ne,"Loading roles...")):(n(),h(O,{key:1,value:l.value.groups,"onUpdate:value":a[9]||(a[9]=s=>l.value.groups=s),class:"flex flex-wrap gap-4"},{default:o(()=>[(n(!0),d(L,null,V(R.value,s=>(n(),h(A,{key:s.id,value:s.id,label:s.name},{default:o(()=>[_(u(s.name),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value"]))]),_:1},8,["header"])]),_:1},8,["activeKey"]),t(I,{activeKey:E.value,"onUpdate:activeKey":a[12]||(a[12]=s=>E.value=s),class:"mt-8"},{default:o(()=>[t(F,{key:"2",header:e.$t("users.table_field.get_permissions"),name:"user_permission",class:"w-full"},{default:o(()=>[j.value?(n(),d("div",Ke,"Loading permission...")):(n(),h(O,{key:1,value:l.value.user_permissions,"onUpdate:value":a[11]||(a[11]=s=>l.value.user_permissions=s),class:"flex flex-wrap gap-4"},{default:o(()=>[(n(!0),d(L,null,V(P.value,s=>(n(),h(A,{key:s.id,value:s.id,label:s.name},{default:o(()=>[_(u(s.name),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value"]))]),_:1},8,["header"])]),_:1},8,["activeKey"]),c("div",Re,[t(v,{class:"flex items-center mt-4 justify-center"},{default:o(()=>[t(x,{type:"primary",onClick:X},{default:o(()=>[_(u(e.$t("users.save")),1)]),_:1}),a[14]||(a[14]=_("   ")),t(x,{danger:"",onClick:a[13]||(a[13]=s=>k(S)({name:"user.list"}))},{default:o(()=>[_(u(e.$t("users.cancel")),1)]),_:1})]),_:1})])]),_:1},8,["rules","model"]))],64)}}}),De=fe(Pe,[["__scopeId","data-v-f99686a3"]]);export{De as default};
