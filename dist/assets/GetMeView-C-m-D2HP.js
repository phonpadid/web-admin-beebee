import{_ as ae}from"./nodata-b6ZJ5XC7.js";import{r as se}from"./role.store-DBlqig8t.js";import{u as le}from"./index-BOJxkmlB.js";import{u as te}from"./index-BtDIkZgz.js";import{p as oe}from"./permissions.store-K_Dw0mD3.js";import{u as re}from"./update-user.schema-cwaZ4FV2.js";import{d as ue,r as n,u as ne,k as ie,l as me,v as de,f as h,g as c,c as r,i as $,j as d,t as m,n as p,h as t,F as S,e as i,o as u,q as V,x as F,s as I,_ as ce}from"./index-DmLjb2yN.js";import{L as pe}from"./LineChartOutlined-suE0mfBf.js";import"./axios.config-9RTEzkkw.js";import"./user.schema-DT440Bsg.js";const fe={class:"pb-4 flex justify-between"},ve={class:"text-base font-bold text-blue-500"},_e={class:"flex flex-col items-center sm:items-start gap-6"},he={key:1,src:ae,width:"200rem",height:"200rem",class:"my-4",style:{"object-fit":"contain"},alt:""},be={class:"md:flex md:flex-row flex-col gap-4"},ge={class:"md:flex md:flex-row flex-col gap-4"},ye={key:0},ke={key:0},xe={class:"md:flex md:flex-row flex-col mt-4"},we={class:"md:flex md:flex-row flex-col gap-4"},Ue=ue({__name:"GetMeView",setup($e){const v=n(null),{schema:O,schemaKey:E}=re(),b=n("");function q(e){return e.size>5242880?(b.value="ຂະໜາດຮູບຕ້ອງບໍ່ເກີນ 5MB",!1):(b.value="",v.value&&URL.revokeObjectURL(v.value),v.value=URL.createObjectURL(e),l.value.avatar=e,!1)}const G=()=>{l.value.avatar=void 0,v.value=""},{state:T,getAll:H}=se(),{statePermission:J,getAllPer:Q}=oe(),{update:W}=le(),{stateGetMe:g}=te(),C=n(null),X=n(!1),l=n({id:"",first_name:"",last_name:"",type:"",phone_number:"",groups:[],is_active:!1,is_superuser:!1,is_staff:!1,user_permissions:[],avatar:void 0,email:""}),{t:_}=ne(),x=ie(()=>({firstName:_("placeholder.user.fname"),lastName:_("placeholder.user.lname"),phoneNumber:_("placeholder.user.phone_number"),email:_("placeholder.user.email"),password:_("placeholder.user.password"),confirmPassword:_("placeholder.user.confirm_password")})),B=n(),N=n(!0),j=n(!0),K=n(["1"]),L=n(["1"]),M=n([]),A=n([]),Y=async()=>{B.value.validate().then(async()=>{X.value=!0,await W(l.value,l.value.id),I.success({message:"Save Success",description:"User saved successfully!"})}).catch(e=>{e.status===403&&I.warn({message:"ເຕືອນ",description:"ທ່ານບໍ່ມີສິດແກ້ໄຂ"})})},Z=async()=>{var e,a,y,w;try{if(await H(),M.value=((a=(e=T.data)==null?void 0:e.props)==null?void 0:a.map(o=>({id:o.id,name:o.name})))||[],N.value=!1,await Q(),A.value=((w=(y=J.data)==null?void 0:y.props)==null?void 0:w.map(o=>({id:o.id,name:o.name})))||[],j.value=!1,g!=null&&g.data){const o=g.data;l.value={...o,groups:Array.isArray(o.groups)?o.groups.map(f=>f.id):[],user_permissions:Array.isArray(o.user_permissions)?o.user_permissions.map(f=>f.id):[]},C.value=o.avatar||null}}catch(o){console.error("Error populating user form:",o)}};return me(()=>g.data,e=>{e&&(l.value={...l.value,id:e.id||"",first_name:e.first_name||"",last_name:e.last_name||"",phone_number:e.phone_number||"",email:e.email||"",is_superuser:e.is_superuser||"",is_active:e.is_active||"",is_staff:e.email||"",groups:e.groups.map(a=>a.id)||[],user_permissions:e.user_permissions.map(a=>a.id)||[],avatar:e.avatar||""},C.value=e.avatar||"")},{immediate:!0}),de(async()=>{await Z()}),(e,a)=>{const y=i("a-image"),w=i("a-alert"),o=i("a-form-item"),f=i("a-button"),D=i("a-upload"),U=i("a-input"),k=i("a-checkbox"),z=i("a-checkbox-group"),P=i("a-collapse-panel"),R=i("a-collapse"),ee=i("a-form");return u(),h(S,null,[c("div",fe,[c("p",ve,[r($(pe)),d(" "+m(e.$t("me.detail")),1)])]),(u(),p(ee,{layout:"vertical",ref_key:"form",ref:B,rules:$(O),key:$(E),model:l.value,class:"flex-col flex"},{default:t(()=>[r(o,{label:" ",class:"-mt-12",name:"avatar"},{default:t(()=>[c("div",_e,[v.value||l.value.avatar?(u(),p(y,{key:0,src:v.value||l.value.avatar,width:"10rem",height:"10rem",style:{"object-fit":"contain"}},{previewMask:t(()=>[c("span",null,m(e.$t("preview")),1)]),_:1},8,["src"])):(u(),h("img",he)),b.value?(u(),p(w,{key:2,message:b.value,type:"error",banner:"",closable:"",onClose:a[0]||(a[0]=s=>b.value="")},null,8,["message"])):V("",!0)])]),_:1}),r(o,{class:"-mt-12",label:" "},{default:t(()=>[r(D,{showUploadList:!1,accept:".png, .jpeg, .jpg",multiple:"","before-upload":q},{default:t(()=>[r(f,null,{default:t(()=>[d(m(e.$t("customers.table_field.choose_profile")),1)]),_:1})]),_:1}),l.value.avatar?(u(),p(f,{key:0,onClick:G,class:"ml-4 text-red-600"},{default:t(()=>[d(m(e.$t("customers.table_field.btn.remove")),1)]),_:1})):V("",!0)]),_:1}),c("div",be,[r(o,{label:e.$t("users.table_field.fname"),name:"first_name",class:"w-full"},{default:t(()=>[r(U,{placeholder:x.value.firstName,class:"h-12",value:l.value.first_name,"onUpdate:value":a[1]||(a[1]=s=>l.value.first_name=s)},null,8,["placeholder","value"])]),_:1},8,["label"]),r(o,{label:e.$t("users.table_field.lname"),name:"last_name",class:"w-full"},{default:t(()=>[r(U,{placeholder:x.value.lastName,class:"h-12",value:l.value.last_name,"onUpdate:value":a[2]||(a[2]=s=>l.value.last_name=s)},null,8,["placeholder","value"])]),_:1},8,["label"])]),c("div",ge,[r(o,{label:e.$t("users.table_field.phone_number"),name:"phone_number",class:"w-full"},{default:t(()=>[r(U,{placeholder:x.value.phoneNumber,class:"h-12",value:l.value.phone_number,"onUpdate:value":a[3]||(a[3]=s=>l.value.phone_number=s)},null,8,["placeholder","value"])]),_:1},8,["label"]),r(o,{label:e.$t("users.table_field.email"),name:"email",class:"w-full"},{default:t(()=>[r(U,{placeholder:x.value.email,class:"h-12",value:l.value.email,"onUpdate:value":a[4]||(a[4]=s=>l.value.email=s)},null,8,["placeholder","value"])]),_:1},8,["label"])]),r(R,{activeKey:K.value,"onUpdate:activeKey":a[6]||(a[6]=s=>K.value=s),class:"mt-2"},{default:t(()=>[r(P,{key:"1",header:e.$t("users.table_field.get_roles"),name:"groups",class:"w-full"},{default:t(()=>[N.value?(u(),h("div",ye,"ບໍ່ມີບົດບາດ...")):(u(),p(z,{key:1,value:l.value.groups,"onUpdate:value":a[5]||(a[5]=s=>l.value.groups=s),class:"flex flex-wrap gap-4"},{default:t(()=>[(u(!0),h(S,null,F(M.value,s=>(u(),p(k,{key:s.id,value:s.id},{default:t(()=>[d(m(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]))]),_:1},8,["header"])]),_:1},8,["activeKey"]),r(R,{activeKey:L.value,"onUpdate:activeKey":a[8]||(a[8]=s=>L.value=s),class:"mt-8"},{default:t(()=>[r(P,{key:"1",header:e.$t("users.table_field.get_permissions"),name:"user_permission",class:"w-full"},{default:t(()=>[j.value?(u(),h("div",ke,"ບໍ່ມີສິດທີ່")):(u(),p(z,{key:1,value:l.value.user_permissions,"onUpdate:value":a[7]||(a[7]=s=>l.value.user_permissions=s),class:"flex flex-wrap gap-4"},{default:t(()=>[(u(!0),h(S,null,F(A.value,s=>(u(),p(k,{key:s.id,value:s.id},{default:t(()=>[d(m(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]))]),_:1},8,["header"])]),_:1},8,["activeKey"]),c("div",xe,[r(o,{label:"",name:"is_superuser",class:"md:w-[10rem]"},{default:t(()=>[r(k,{checked:l.value.is_superuser,onChange:a[9]||(a[9]=s=>l.value.is_superuser=s.target.checked)},{default:t(()=>[d(m(e.$t("users.table_field.super_user")),1)]),_:1},8,["checked"])]),_:1}),r(o,{label:"",name:"is_staff",class:"md:w-[10rem]"},{default:t(()=>[r(k,{checked:l.value.is_staff,onChange:a[10]||(a[10]=s=>l.value.is_staff=s.target.checked)},{default:t(()=>[d(m(e.$t("users.table_field.staff")),1)]),_:1},8,["checked"])]),_:1}),r(o,{label:"",name:"is_active",class:"md:w-[10rem]"},{default:t(()=>[r(k,{checked:l.value.is_active,onChange:a[11]||(a[11]=s=>l.value.is_active=s.target.checked)},{default:t(()=>[d(m(e.$t("users.table_field.status")),1)]),_:1},8,["checked"])]),_:1})]),c("div",we,[r(o,{class:"flex items-center mt-4 justify-center"},{default:t(()=>[r(f,{type:"primary",onClick:Y},{default:t(()=>[d(m(e.$t("me.btn")),1)]),_:1})]),_:1})])]),_:1},8,["rules","model"]))],64)}}}),Pe=ce(Ue,[["__scopeId","data-v-5a1c5e3a"]]);export{Pe as default};
