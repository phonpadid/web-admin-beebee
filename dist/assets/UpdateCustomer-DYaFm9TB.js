import{_ as ce}from"./nodata-b6ZJ5XC7.js";import{r as pe}from"./role.store-CwGpHvrs.js";import{k as J,d as _e,r as c,u as ve,m as fe,v as ge,l as be,f as p,g as _,c as t,h as U,j as d,t as u,n as f,i as r,F as K,b as he,e as n,a as ye,o,q as y,p as C,x as H,s as ke,_ as we}from"./index-B4OLFXgi.js";import{p as xe}from"./permissions.store-DuAphxP9.js";import{u as $e}from"./user.schema-DF8PrA2I.js";import{c as Ue}from"./index-Co7AWFst.js";import{L as Ce}from"./LineChartOutlined-DLTvqI0r.js";import"./axios.config-9RTEzkkw.js";const Se=()=>{const{schema:R,schemaKey:S}=$e();return{schema:J(()=>{const{password:A,password_confirmation:L,...N}=R.value;return N}),schemaKey:S}},Le={class:"pb-4 flex justify-between"},Ne={class:"text-base font-bold text-blue-500"},je={class:"flex flex-col items-center sm:items-start gap-6"},Be={key:1,src:ce,width:"200rem",height:"200rem",class:"my-6",style:{"object-fit":"contain"},alt:""},Ke={class:"md:flex md:flex-row flex-col gap-4"},Re={key:0,class:"text-red-500"},ze={key:0,class:"text-red-500"},Ae={class:"md:flex md:flex-row flex-col gap-4"},Me={key:0,class:"text-red-500"},Oe={key:0,class:"text-red-500"},Fe={key:1,class:"text-red-500"},Ee={class:"md:flex md:flex-row flex-col gap-4"},Ie={key:0},Pe={key:0},De={class:"md:flex md:flex-row flex-col mt-4"},Ve={class:"md:flex md:flex-row flex-col gap-4"},qe=_e({__name:"UpdateCustomer",setup(R){const{schema:S,schemaKey:z}=Se(),A=ye(),{push:L}=A,{state:N,getAll:Q}=pe(),{statePermission:W,getAllPer:X}=xe(),M=c(null),{update:Y,stateGetOne:j,getOneCustomer:Z}=Ue(),{t:g}=ve(),w=J(()=>({firstName:g("placeholder.user.fname"),lastName:g("placeholder.user.lname"),phoneNumber:g("placeholder.user.phone_number"),email:g("placeholder.user.email")})),O={customer_id:"",id:"",first_name:"",last_name:"",type:"",phone_number:"",groups:[],is_active:!1,is_superuser:!1,user_permissions:[],avatar:void 0,full_avatar_url:void 0,email:"",password:"",created_at:"",updated_at:""},F=c(),s=c({...O}),ee=()=>{s.value={...O},M.value=""},i=fe({}),ae=async()=>{F.value.validate().then(async()=>{try{await Y(s.value,s.value.id),ke.success({message:g("messages.success"),description:g("messages.update")}),ee(),L({name:"customers"})}catch(e){if(e.response&&e.response.data){const a=e.response.data||{};Object.keys(a).forEach(v=>{i[v]=Array(a[v])?a[v][0]:""})}}})},E=c([]),I=c([]),B=c(!0),se=c(!0),P=c(["2"]),D=c(["2"]),{params:le}=he(),te=Number(le.id),re=async()=>{if(await Q(),E.value=N.data.props.map(e=>({id:e.id,name:e.name})),B.value=!1,await X(),I.value=W.data.props.map(e=>({id:e.id,name:e.name})),se.value=!1,await Z(te),j.data){const e=j.data;s.value={...e,groups:Array.isArray(e.groups)?e.groups.map(a=>a.id):e.groups,user_permissions:Array.isArray(e.user_permissions)?e.user_permissions.map(a=>a.id):e.user_permissions},M.value=e.full_avatar_url||null}},k=c(""),b=c(null);function oe(e){return e.size>5242880?(k.value="ຂະໜາດຮູບຕ້ອງບໍ່ເກີນ 5MB",!1):(k.value="",b.value&&URL.revokeObjectURL(b.value),b.value=URL.createObjectURL(e),s.value.full_avatar_url=e,!1)}const ue=()=>{s.value.full_avatar_url=void 0,b.value=""};return ge(()=>{re()}),be(()=>j.data,e=>{if(e){const a=e;s.value.user_permissions=a.user_permissions.map(v=>v.id)}},{immediate:!0}),(e,a)=>{const v=n("a-image"),ne=n("a-alert"),m=n("a-form-item"),x=n("a-button"),ie=n("a-upload"),h=n("a-input"),$=n("a-checkbox"),V=n("a-checkbox-group"),q=n("a-collapse-panel"),G=n("a-collapse"),T=n("a-radio"),me=n("a-radio-group"),de=n("a-form");return o(),p(K,null,[_("div",Le,[_("p",Ne,[t(U(Ce)),d(" "+u(e.$t("customers.form_edit")),1)])]),(o(),f(de,{layout:"vertical",ref_key:"form",ref:F,rules:U(S),key:U(z),model:s.value,class:"flex-col flex"},{default:r(()=>[t(m,{label:" ",class:"-mt-12",name:"avatar"},{default:r(()=>[_("div",je,[b.value||s.value.full_avatar_url?(o(),f(v,{key:0,src:b.value||s.value.full_avatar_url,width:"10rem",height:"10rem",style:{"object-fit":"contain"}},{previewMask:r(()=>[_("span",null,u(e.$t("preview")),1)]),_:1},8,["src"])):(o(),p("img",Be)),k.value?(o(),f(ne,{key:2,message:k.value,type:"error",banner:"",closable:"",onClose:a[0]||(a[0]=l=>k.value="")},null,8,["message"])):y("",!0)])]),_:1}),t(m,{class:"-mt-12",label:" "},{default:r(()=>[t(ie,{showUploadList:!1,accept:".png, .jpeg, .jpg",multiple:"","before-upload":oe},{default:r(()=>[t(x,null,{default:r(()=>[d(u(e.$t("customers.table_field.choose_profile")),1)]),_:1})]),_:1}),s.value.full_avatar_url?(o(),f(x,{key:0,onClick:ue,class:"ml-4 text-red-600"},{default:r(()=>[d(u(e.$t("customers.table_field.btn.remove")),1)]),_:1})):y("",!0)]),_:1}),_("div",Ke,[t(m,{label:e.$t("customers.table_field.fname"),name:"first_name",class:"w-full"},{default:r(()=>[t(h,{placeholder:w.value.firstName,class:C(["h-12",{"ring-1 ring-red-500 mb-1":i.errors&&s.value.first_name.length>149}]),value:s.value.first_name,"onUpdate:value":a[1]||(a[1]=l=>s.value.first_name=l)},null,8,["placeholder","value","class"]),i.errors&&s.value.first_name.length>149?(o(),p("span",Re,u(e.$t("validation.user.length_name")),1)):y("",!0)]),_:1},8,["label"]),t(m,{label:e.$t("customers.table_field.lname"),name:"last_name",class:"w-full"},{default:r(()=>[t(h,{placeholder:w.value.lastName,class:C(["h-12",{"ring-1 ring-red-500 mb-1":i.errors&&s.value.last_name.length>149}]),value:s.value.last_name,"onUpdate:value":a[2]||(a[2]=l=>s.value.last_name=l)},null,8,["placeholder","value","class"]),i.errors&&s.value.last_name.length>149?(o(),p("span",ze,u(e.$t("validation.user.length_name")),1)):y("",!0)]),_:1},8,["label"])]),_("div",Ae,[t(m,{label:e.$t("customers.table_field.phone_number"),name:"phone_number",class:"w-full"},{default:r(()=>[t(h,{placeholder:w.value.phoneNumber,class:C(["h-12",{"ring-1 ring-red-500 mb-1":i.errors&&s.value.phone_number.length>11}]),value:s.value.phone_number,"onUpdate:value":a[3]||(a[3]=l=>s.value.phone_number=l)},null,8,["placeholder","value","class"]),i.errors&&s.value.phone_number.length>11?(o(),p("span",Me,u(e.$t("validation.user.length_phone")),1)):y("",!0)]),_:1},8,["label"]),t(m,{label:e.$t("customers.table_field.email"),name:"email",class:"w-full"},{default:r(()=>[t(h,{placeholder:w.value.email,class:C(["h-12",{"ring-1 ring-red-500 mb-1":i.errors&&s.value.email.length>254||i.errors==="d"}]),value:s.value.email,"onUpdate:value":a[4]||(a[4]=l=>s.value.email=l)},null,8,["placeholder","value","class"]),i.errors&&s.value.email.length>254?(o(),p("span",Oe,u(e.$t("validation.user.email_length")),1)):i.errors&&i.errors==="d"?(o(),p("span",Fe,u(e.$t("validation.user.email_exits")),1)):y("",!0)]),_:1},8,["label"])]),_("div",Ee,[t(m,{label:e.$t("customers.table_field.created_at"),name:"",class:"w-full"},{default:r(()=>[t(h,{readonly:"",placeholder:"ວັນທີອັບເດດ",class:"h-12",value:s.value.created_at,"onUpdate:value":a[5]||(a[5]=l=>s.value.created_at=l)},null,8,["value"])]),_:1},8,["label"]),t(m,{label:e.$t("customers.table_field.updated_at"),name:"",class:"w-full"},{default:r(()=>[t(h,{readonly:"",class:"h-12",value:s.value.updated_at,"onUpdate:value":a[6]||(a[6]=l=>s.value.updated_at=l)},null,8,["value"])]),_:1},8,["label"])]),t(G,{activeKey:P.value,"onUpdate:activeKey":a[8]||(a[8]=l=>P.value=l),class:"mt-2"},{default:r(()=>[t(q,{key:"2",header:e.$t("customers.table_field.get_roles"),name:"groups",class:"w-full"},{default:r(()=>[B.value?(o(),p("div",Ie,"Loading roles...")):(o(),f(V,{key:1,value:s.value.groups,"onUpdate:value":a[7]||(a[7]=l=>s.value.groups=l),class:"flex flex-wrap gap-4"},{default:r(()=>[(o(!0),p(K,null,H(E.value,l=>(o(),f($,{key:l.id,value:l.id,label:l.name},{default:r(()=>[d(u(l.name),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value"]))]),_:1},8,["header"])]),_:1},8,["activeKey"]),t(G,{activeKey:D.value,"onUpdate:activeKey":a[10]||(a[10]=l=>D.value=l),class:"mt-8"},{default:r(()=>[t(q,{key:"2",header:e.$t("customers.table_field.get_permissions"),name:"user_permission",class:"w-full"},{default:r(()=>[B.value?(o(),p("div",Pe,"Loading permission...")):(o(),f(V,{key:1,value:s.value.user_permissions,"onUpdate:value":a[9]||(a[9]=l=>s.value.user_permissions=l),class:"flex flex-wrap gap-4"},{default:r(()=>[(o(!0),p(K,null,H(I.value,l=>(o(),f($,{key:l.id,value:l.id,label:l.name},{default:r(()=>[d(u(l.name),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value"]))]),_:1},8,["header"])]),_:1},8,["activeKey"]),_("div",De,[t(m,{label:"",name:"is_superuser",class:"md:w-[8rem]"},{default:r(()=>[t($,{checked:s.value.is_superuser,onChange:a[11]||(a[11]=l=>s.value.is_superuser=l.target.checked)},{default:r(()=>[d(u(e.$t("customers.table_field.super_user")),1)]),_:1},8,["checked"])]),_:1}),t(m,{label:"",name:"is_active",class:"md:w-[6rem]"},{default:r(()=>[t($,{checked:s.value.is_active,onChange:a[12]||(a[12]=l=>s.value.is_active=l.target.checked)},{default:r(()=>[d(u(e.$t("customers.table_field.status")),1)]),_:1},8,["checked"])]),_:1}),t(m,{label:"",name:"type",class:""},{default:r(()=>[t(me,{value:s.value.type,"onUpdate:value":a[13]||(a[13]=l=>s.value.type=l)},{default:r(()=>[t(T,{value:"general"},{default:r(()=>[d(u(e.$t("customers.table_field.choose_customer.general")),1)]),_:1}),t(T,{value:"vip"},{default:r(()=>[d(u(e.$t("customers.table_field.choose_customer.vip")),1)]),_:1})]),_:1},8,["value"])]),_:1})]),_("div",Ve,[t(m,{class:"flex items-center mt-4 justify-center"},{default:r(()=>[t(x,{type:"primary",onClick:ae},{default:r(()=>[d(u(e.$t("customers.edit")),1)]),_:1}),a[15]||(a[15]=d("   ")),t(x,{danger:"",onClick:a[14]||(a[14]=l=>U(L)({name:"customers"}))},{default:r(()=>[d(u(e.$t("customers.table_field.btn.cancel")),1)]),_:1})]),_:1})])]),_:1},8,["rules","model"]))],64)}}}),Ze=we(qe,[["__scopeId","data-v-f9f27b6a"]]);export{Ze as default};
