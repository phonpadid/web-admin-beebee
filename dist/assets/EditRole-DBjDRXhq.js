import{u as G}from"./role.schema-Cs1BFjKF.js";import{r as H}from"./role.store-CX8tLYic.js";import{p as J}from"./permissions.store-1L6rt9_s.js";import{d as Q,r as p,m as W,v as X,u as Y,k as Z,o as n,f,g,h as m,c as r,j as v,t as c,n as b,i as o,e as l,b as ee,a as se,E as ae,p as te,q as oe,F as ne,x as re,s as le}from"./index-BpXBQnxn.js";import"./axios.config-9RTEzkkw.js";const ie={class:"form-role"},me={class:"pb-4 flex justify-between"},ce={class:"text-base font-bold text-blue-500 flex items-center gap-1"},ue={key:0,style:{color:"red"}},de={key:1,style:{color:"red"}},pe={key:0},fe={class:"md:flex md:flex-row flex-col gap-4"},ke=Q({__name:"EditRole",setup(ve){const{schema:S,schemaKey:R}=G(),{update:j,getDetail:A,getAll:D}=H(),{getAllPer:F,statePermission:K}=J(),k=p(["2"]),x=p(!1),u=p(!1),{params:N}=ee(),w=p(),{push:y}=se(),$={id:"",name:"",permissions:[]},t=p({...$}),i=W({}),P=async()=>{w.value.validate().then(async()=>{x.value=!0;try{await j(t.value,t.value.id),le.success({message:h("messages.success"),description:h("messages.update")}),y({name:"roles.index"}),await D(),V()}catch(e){if(e.response&&e.response.data){const s=e.response.data||{};Object.keys(s).forEach(d=>{i[d]=Array.isArray(s[d])?s[d][0]:""})}}finally{x.value=!1}}).catch(e=>{console.log("Validation error",e)})},V=()=>{t.value={...$}},B=async()=>{u.value=!0;try{const e=await A(Number(N.id));e&&(t.value={...e.data,permissions:e.data.permissions.map(s=>s.id)})}catch(e){console.error("Error fetching role details:",e)}finally{u.value=!1}},L=async()=>{u.value=!0;try{await F()}catch(e){console.error("Error fetching permissions:",e)}finally{u.value=!1}};X(async()=>{await B(),await L()});const U=e=>{i[e]=""},{t:h}=Y(),I=Z(()=>({name:h("placeholder.role.name")}));return(e,s)=>{const d=l("a-input"),C=l("a-form-item"),O=l("a-checkbox"),q=l("a-checkbox-group"),z=l("a-collapse-panel"),M=l("a-collapse"),E=l("a-button"),T=l("a-form");return n(),f("div",ie,[g("div",me,[g("p",ce,[g("span",{onClick:s[0]||(s[0]=a=>m(y)({name:"roles.index"})),class:"hover:ring-red-300 text-[12px] w-10 h-6 ring-1 ring-slate-300 rounded-sm flex items-center justify-center outline-none"},[r(m(ae))]),v(" "+c(e.$t("messages.role.form_edit")),1)])]),(n(),b(T,{layout:"vertical",ref_key:"form",ref:w,rules:m(S),key:m(R),model:t.value},{default:o(()=>[r(C,{class:"form-item-centered",label:e.$t("messages.role.name"),name:"name"},{default:o(()=>[r(d,{value:t.value.name,"onUpdate:value":s[1]||(s[1]=a=>t.value.name=a),placeholder:I.value.name,onInput:s[2]||(s[2]=a=>U("name")),class:te(["h-[3rem]",{"ring-1 ring-red-500 mb-1":i.name}])},null,8,["value","placeholder","class"]),i.name&&i.name.length>=50?(n(),f("span",ue,c(e.$t("messages.more_then")),1)):i.name&&i.name.length<40?(n(),f("span",de,c(e.$t("messages.exist_name")),1)):oe("",!0)]),_:1},8,["label"]),r(M,{activeKey:k.value,"onUpdate:activeKey":s[4]||(s[4]=a=>k.value=a),class:"mt-8"},{default:o(()=>[r(z,{key:"2",header:e.$t("messages.role.form.get_permissions"),name:"permissions",class:"w-full"},{default:o(()=>[u.value?(n(),f("div",pe,"Loading permissions...")):(n(),b(q,{key:1,value:t.value.permissions,"onUpdate:value":s[3]||(s[3]=a=>t.value.permissions=a),class:"flex flex-wrap gap-4"},{default:o(()=>{var a;return[(n(!0),f(ne,null,re(((a=m(K).data)==null?void 0:a.props)||[],_=>(n(),b(O,{key:_.id,value:_.id,label:_.name},{default:o(()=>[v(c(_.name),1)]),_:2},1032,["value","label"]))),128))]}),_:1},8,["value"]))]),_:1},8,["header"])]),_:1},8,["activeKey"]),g("div",fe,[r(C,{class:"flex items-center mt-4 justify-center"},{default:o(()=>[r(E,{type:"primary",onClick:P},{default:o(()=>[v(c(e.$t("messages.role.edit")),1)]),_:1}),s[6]||(s[6]=v(" Â  ")),r(E,{onClick:s[5]||(s[5]=a=>m(y)({name:"roles.index"})),danger:""},{default:o(()=>[v(c(e.$t("messages.role.btn.cancel")),1)]),_:1})]),_:1})])]),_:1},8,["rules","model"]))])}}});export{ke as default};
