import{i as _,a as l,A as f,b as v}from"./axios.config-9RTEzkkw.js";import{z as P,a as y,m as p,B as O}from"./index-BpXBQnxn.js";var S=Object.defineProperty,b=Object.getOwnPropertyDescriptor,M=(s,a,e,r)=>{for(var t=r>1?void 0:r?b(a,e):a,o=s.length-1,i;o>=0;o--)(i=s[o])&&(t=(r?i(a,e,t):i(t))||t);return r&&t&&S(a,e,t),t},$=(s,a)=>(e,r)=>a(e,r,s);let u=class{constructor(s){this._api=s}async login(s){return{data:(await this._api.axios({method:"post",url:"/auth/login/",data:{email:s.email,password:s.password}})).data,message:"ເຂົ້າສູ່ລະບົບສຳເລັດແລ້ວ",status:"success"}}async showMe(){return{data:(await this._api.axios({url:"/auth/me/"})).data,status:"success"}}async changePassword(s){return{data:(await this._api.axios({method:"put",url:`/auth/change-password/${s.id}`,data:{old_password:s.old_password,new_password:s.new_password}})).data,message:"ອັບເດດສຳເລັດ",status:"success"}}};u=M([_(),$(0,l(f))],u);var j=Object.defineProperty,x=Object.getOwnPropertyDescriptor,I=(s,a,e,r)=>{for(var t=r>1?void 0:r?x(a,e):a,o=s.length-1,i;o>=0;o--)(i=s[o])&&(t=(r?i(a,e,t):i(t))||t);return r&&t&&j(a,e,t),t},A=(s,a)=>(e,r)=>a(e,r,s);let d=class{constructor(s){this._api=s}async execute(s){return await this._api.login(s)}};d=I([_(),A(0,l(u))],d);var D=Object.defineProperty,L=Object.getOwnPropertyDescriptor,R=(s,a,e,r)=>{for(var t=r>1?void 0:r?L(a,e):a,o=s.length-1,i;o>=0;o--)(i=s[o])&&(t=(r?i(a,e,t):i(t))||t);return r&&t&&D(a,e,t),t},m=(s,a)=>(e,r)=>a(e,r,s);let h=class{constructor(s,a){this._login=s,this._authReposioty=a}async login(s){return await this._login.execute(s)}async showMe(){return await this._authReposioty.showMe()}async changePassowrd(s){return await this._authReposioty.changePassword(s)}};h=R([_(),m(0,l(d)),m(1,l(u))],h);const N=P("auth",()=>{const s=y(),a=v.resolve(h),e=p({data:null,isLoading:!1,errorMessage:""});let r=p({email:"",password:""});async function t(n){e.isLoading=!0;const c=await a.login(n);c.status==="success"&&c.data?(localStorage.setItem("access",c.data.access),localStorage.setItem("roles",JSON.stringify(c.data.roles)),localStorage.setItem("permissions",JSON.stringify(c.data.permissions)),O.success({content:"ຍີນດີຕ້ອນຮັບເຂົ້າສູ່ລະບົບ.",duration:3}),s.push({name:"admin_dashboard"}),g()):(console.log("errMessage:"),e.errorMessage=c.message?c.message:""),e.isLoading=!1}async function o(){localStorage.removeItem("access"),localStorage.removeItem("roles"),localStorage.removeItem("permissions"),localStorage.removeItem("locale"),s.push({name:"login"})}async function i(){e.isLoading=!0;const n=await a.showMe();n&&n.data&&n.status==="success"&&(e.data=n.data,e.isLoading=!1)}async function w(n){return await a.changePassowrd(n)}function g(){r=p({email:"",password:""})}return{stateGetMe:e,form:r,login:t,logout:o,showMe:i,changePassword:w,clearFormUser:g}});export{N as u};
