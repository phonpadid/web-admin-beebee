import{_ as ue}from"./nodata-b6ZJ5XC7.js";import{r as ie}from"./role.store-CX8tLYic.js";import{u as me}from"./index-9lTxRn36.js";import{d as de,r as m,u as pe,k as ce,m as ve,v as fe,l as _e,o as n,f as d,g as v,h as $,c as r,j as p,t as o,n as g,i as t,F as B,b as ge,e as c,a as he,E as be,q as b,p as S,x as I,s as ye,_ as ke}from"./index-BpXBQnxn.js";import{p as we}from"./permissions.store-1L6rt9_s.js";import{u as xe}from"./update-user.schema-BBUVuOA1.js";import"./axios.config-9RTEzkkw.js";import"./user.schema-CzutrDlL.js";const $e={class:"pb-4 flex justify-between"},Ue={class:"text-base font-bold text-blue-500 flex items-center gap-1"},Se={class:"flex flex-col items-center sm:items-start gap-6"},Ce={key:1,src:ue,width:"200rem",height:"200rem",class:"my-4",style:{"object-fit":"contain"},alt:""},Ne={class:"md:flex md:flex-row flex-col gap-4"},je={key:0,class:"text-red-500"},Be={key:0,class:"text-red-500"},Le={class:"md:flex md:flex-row flex-col gap-4"},Ee={key:0,class:"text-red-500"},Ke={key:0,class:"text-red-500"},Ae={key:1,class:"text-red-500"},Pe={key:0},Re={key:0},ze={class:"md:flex md:flex-row flex-col mt-4"},Me={class:"md:flex md:flex-row flex-col gap-4"},Oe=de({__name:"EditProfile",props:{searchQuery:{type:String,default:null}},setup(Fe){const{schema:D,schemaKey:V}=xe(),q=he(),{push:C}=q,{state:G,getAll:Q}=ie(),{statePermission:T,getAllPer:H}=we(),L=m(null),{update:J,stateGetOne:N,getOneUser:W}=me(),E={id:"",first_name:"",last_name:"",type:"",phone_number:"",groups:[],is_active:!1,is_superuser:!1,is_staff:!1,user_permissions:[],avatar:void 0,email:"",password:""},{t:f}=pe(),y=ce(()=>({firstName:f("placeholder.user.fname"),lastName:f("placeholder.user.lname"),phoneNumber:f("placeholder.user.phone_number"),email:f("placeholder.user.email"),password:f("placeholder.user.password"),confirmPassword:f("placeholder.user.confirm_password")})),K=m(),s=m({...E}),X=()=>{s.value={...E},L.value=""},u=ve({}),Y=async()=>{K.value.validate().then(async()=>{try{await J(s.value,s.value.id),ye.success({message:f("messages.success"),description:f("messages.update")}),X(),C({name:"user"})}catch(e){if(e.response&&e.response.data){const a=e.response.data||{};Object.keys(a).forEach(_=>{u[_]=Array(a[_])?a[_][0]:""})}}})},A=m([]),P=m([]),j=m(!0),Z=m(!0),R=m(["2"]),z=m(["2"]),{params:ee}=ge(),ae=Number(ee.id),se=async()=>{if(await Q(),A.value=G.data.props.map(e=>({id:e.id,name:e.name})),j.value=!1,await H(),P.value=T.data.props.map(e=>({id:e.id,name:e.name})),Z.value=!1,await W(ae),N.data){const e=N.data;s.value={...e,groups:Array.isArray(e.groups)?e.groups.map(a=>a.id):e.groups,user_permissions:Array.isArray(e.user_permissions)?e.user_permissions.map(a=>a.id):e.user_permissions},L.value=e.avatar||null}},k=m(""),h=m(null);function le(e){return e.size>5242880?(k.value="ຂະໜາດຮູບຕ້ອງບໍ່ເກີນ 5MB",!1):(k.value="",h.value&&URL.revokeObjectURL(h.value),h.value=URL.createObjectURL(e),s.value.avatar=e,!1)}const te=()=>{s.value.avatar=void 0,h.value=""};return fe(()=>{se()}),_e(()=>N.data,e=>{if(e){const a=e;s.value.user_permissions=a.user_permissions.map(_=>_.id)}},{immediate:!0}),(e,a)=>{const _=c("a-image"),re=c("a-alert"),i=c("a-form-item"),U=c("a-button"),ne=c("a-upload"),w=c("a-input"),x=c("a-checkbox"),M=c("a-checkbox-group"),O=c("a-collapse-panel"),F=c("a-collapse"),oe=c("a-form");return n(),d(B,null,[v("div",$e,[v("p",Ue,[v("span",{onClick:a[0]||(a[0]=l=>$(C)({name:"user"})),class:"hover:ring-red-300 text-[12px] w-10 h-6 ring-1 ring-slate-300 rounded-sm flex items-center justify-center outline-none"},[r($(be))]),p(" "+o(e.$t("users.edit_user")),1)])]),(n(),g(oe,{layout:"vertical",ref_key:"form",ref:K,rules:$(D),key:$(V),model:s.value,class:"flex-col flex"},{default:t(()=>[r(i,{label:" ",class:"-mt-12",name:"avatar"},{default:t(()=>[v("div",Se,[h.value||s.value.avatar?(n(),g(_,{key:0,src:h.value||s.value.avatar,width:"10rem",height:"10rem",style:{"object-fit":"contain"}},{previewMask:t(()=>[v("span",null,o(e.$t("preview")),1)]),_:1},8,["src"])):(n(),d("img",Ce)),k.value?(n(),g(re,{key:2,message:k.value,type:"error",banner:"",closable:"",onClose:a[1]||(a[1]=l=>k.value="")},null,8,["message"])):b("",!0)])]),_:1}),r(i,{class:"-mt-12",label:" "},{default:t(()=>[r(ne,{showUploadList:!1,accept:".png, .jpeg, .jpg",multiple:"","before-upload":le},{default:t(()=>[r(U,null,{default:t(()=>[p(o(e.$t("customers.table_field.choose_profile")),1)]),_:1})]),_:1}),s.value.avatar?(n(),g(U,{key:0,onClick:te,class:"ml-4 text-red-600"},{default:t(()=>[p(o(e.$t("customers.table_field.btn.remove")),1)]),_:1})):b("",!0)]),_:1}),v("div",Ne,[r(i,{hidden:"",label:"",name:"id",class:"w-full"},{default:t(()=>[r(w,{placeholder:y.value.firstName,class:"h-12",value:s.value.id,"onUpdate:value":a[2]||(a[2]=l=>s.value.id=l)},null,8,["placeholder","value"])]),_:1}),r(i,{label:e.$t("users.table_field.fname"),name:"first_name",class:"w-full"},{default:t(()=>[r(w,{placeholder:y.value.firstName,class:S(["h-12",{"ring-1 ring-red-500 mb-1":u.first_name&&s.value.first_name.length>149}]),value:s.value.first_name,"onUpdate:value":a[3]||(a[3]=l=>s.value.first_name=l)},null,8,["placeholder","class","value"]),u.first_name&&s.value.first_name.length>149?(n(),d("span",je,o(e.$t("validation.user.length_name")),1)):b("",!0)]),_:1},8,["label"]),r(i,{label:e.$t("users.table_field.lname"),name:"last_name",class:"w-full"},{default:t(()=>[r(w,{placeholder:y.value.lastName,class:S(["h-12",{"ring-1 ring-red-500 mb-1":u.last_name&&s.value.last_name.length>149}]),value:s.value.last_name,"onUpdate:value":a[4]||(a[4]=l=>s.value.last_name=l)},null,8,["placeholder","class","value"]),u.last_name&&s.value.last_name.length>149?(n(),d("span",Be,o(e.$t("validation.user.length_name")),1)):b("",!0)]),_:1},8,["label"])]),v("div",Le,[r(i,{label:e.$t("users.table_field.phone_number"),name:"phone_number",class:"w-full"},{default:t(()=>[r(w,{placeholder:y.value.phoneNumber,class:S(["h-12",{"ring-1 ring-red-500 mb-1":u.phone_number&&s.value.phone_number.length>11}]),value:s.value.phone_number,"onUpdate:value":a[5]||(a[5]=l=>s.value.phone_number=l)},null,8,["placeholder","class","value"]),u.phone_number&&s.value.phone_number.length>11?(n(),d("span",Ee,o(e.$t("validation.user.length_phone")),1)):b("",!0)]),_:1},8,["label"]),r(i,{label:e.$t("users.table_field.email"),name:"email",class:"w-full"},{default:t(()=>[r(w,{placeholder:y.value.email,class:S(["h-12",{"ring-1 ring-red-500 mb-1":u.email&&s.value.email.length>254||u.email==="user with this email address already exists."||u.email==="Enter a valid email address."}]),value:s.value.email,"onUpdate:value":a[6]||(a[6]=l=>s.value.email=l)},null,8,["placeholder","class","value"]),u.email&&s.value.email.length>254?(n(),d("span",Ke,o(e.$t("validation.user.email_length")),1)):u.email&&u.email==="user with this email address already exists."?(n(),d("span",Ae,o(e.$t("validation.user.email_exits")),1)):b("",!0)]),_:1},8,["label"])]),r(F,{activeKey:R.value,"onUpdate:activeKey":a[8]||(a[8]=l=>R.value=l),class:"mt-2"},{default:t(()=>[r(O,{key:"2",header:e.$t("users.table_field.get_roles"),name:"groups",class:"w-full"},{default:t(()=>[j.value?(n(),d("div",Pe,"Loading roles...")):(n(),g(M,{key:1,value:s.value.groups,"onUpdate:value":a[7]||(a[7]=l=>s.value.groups=l),class:"flex flex-wrap gap-4"},{default:t(()=>[(n(!0),d(B,null,I(A.value,l=>(n(),g(x,{key:l.id,value:l.id,label:l.name},{default:t(()=>[p(o(l.name),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value"]))]),_:1},8,["header"])]),_:1},8,["activeKey"]),r(F,{activeKey:z.value,"onUpdate:activeKey":a[10]||(a[10]=l=>z.value=l),class:"mt-8"},{default:t(()=>[r(O,{key:"2",header:e.$t("users.table_field.get_roles"),name:"user_permission",class:"w-full"},{default:t(()=>[j.value?(n(),d("div",Re,"Loading permission...")):(n(),g(M,{key:1,value:s.value.user_permissions,"onUpdate:value":a[9]||(a[9]=l=>s.value.user_permissions=l),class:"flex flex-wrap gap-4"},{default:t(()=>[(n(!0),d(B,null,I(P.value,l=>(n(),g(x,{key:l.id,value:l.id,label:l.name},{default:t(()=>[p(o(l.name),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value"]))]),_:1},8,["header"])]),_:1},8,["activeKey"]),v("div",ze,[r(i,{label:"",name:"is_superuser",class:"md:w-[10rem]"},{default:t(()=>[r(x,{checked:s.value.is_superuser,onChange:a[11]||(a[11]=l=>s.value.is_superuser=l.target.checked)},{default:t(()=>[p(o(e.$t("users.table_field.super_user")),1)]),_:1},8,["checked"])]),_:1}),r(i,{label:"",name:"is_staff",class:"md:w-[10rem]"},{default:t(()=>[r(x,{checked:s.value.is_staff,onChange:a[12]||(a[12]=l=>s.value.is_staff=l.target.checked)},{default:t(()=>[p(o(e.$t("users.table_field.staff")),1)]),_:1},8,["checked"])]),_:1}),r(i,{label:"",name:"is_active",class:"md:w-[10rem]"},{default:t(()=>[r(x,{checked:s.value.is_active,onChange:a[13]||(a[13]=l=>s.value.is_active=l.target.checked)},{default:t(()=>[p(o(e.$t("users.table_field.status")),1)]),_:1},8,["checked"])]),_:1})]),v("div",Me,[r(i,{class:"flex items-center mt-4 justify-center"},{default:t(()=>[r(U,{type:"primary",onClick:Y},{default:t(()=>[p(o(e.$t("users.edit")),1)]),_:1}),a[15]||(a[15]=p("   ")),r(U,{danger:"",onClick:a[14]||(a[14]=l=>$(C)({name:"user.list"}))},{default:t(()=>[p(o(e.$t("users.cancel")),1)]),_:1})]),_:1})])]),_:1},8,["rules","model"]))],64)}}}),Je=ke(Oe,[["__scopeId","data-v-70e1b286"]]);export{Je as default};
