import{z as se,m as M,d as K,e as v,o as y,n as V,h as d,E as H,f as j,c as o,i as $,j as P,F as X,p as Y,u as R,r as g,k as B,l as Z,t as x,q,g as N,s as F,v as ne}from"./index-DmLjb2yN.js";import{i as ee,a as ae,A as oe,b as le}from"./axios.config-9RTEzkkw.js";import{I,_ as J}from"./iconify-Bb7yeU_0.js";import{L as re}from"./LineChartOutlined-suE0mfBf.js";var ie=Object.defineProperty,ce=Object.getOwnPropertyDescriptor,de=(e,a,t,s)=>{for(var n=s>1?void 0:s?ce(a,t):a,m=e.length-1,p;m>=0;m--)(p=e[m])&&(n=(s?p(a,t,n):p(n))||n);return s&&n&&ie(a,t,n),n},me=(e,a)=>(t,s)=>a(t,s,e);let U=class{constructor(e){this._api=e}async create(e){const a=await this._api.axios({method:"post",url:"/tenants/",data:{name:e.name,schema_name:e.schema_name,domain:e.domain}});return console.log(a),{data:a.data,message:"ບັນທຶກສຳເລັດ",status:"success"}}async update(e,a){return console.log("idTenant:",a),{data:(await this._api.axios({method:"put",url:`/tenants/${a}/`,data:{id:a,name:e.name,schema_name:e.schema_name,domain:e.domain}})).data,message:"ອັບເດດສຳເລັດ",status:"success"}}async updateDomain(e,a){var s;return console.log(),{data:(await this._api.axios({method:"put",url:`/domains/${a}/`,data:{id:a,name:e.name,schema_name:e.schema_name,domain:e.domain,tenant:(s=e.id)==null?void 0:s.toString()}})).data,message:"ອັບເດດສຳເລັດ",status:"success"}}async getAll(e){const a=await this._api.axios({url:"/tenants/",params:{page:e.page,page_size:e.limit}}),{results:t,count:s}=a.data;return{data:{props:t,total:s},status:"success"}}};U=de([ee(),me(0,ae(oe))],U);var ue=Object.defineProperty,pe=Object.getOwnPropertyDescriptor,_e=(e,a,t,s)=>{for(var n=s>1?void 0:s?pe(a,t):a,m=e.length-1,p;m>=0;m--)(p=e[m])&&(n=(s?p(a,t,n):p(n))||n);return s&&n&&ue(a,t,n),n},fe=(e,a)=>(t,s)=>a(t,s,e);let Q=class{constructor(e){this._api=e}async create(e){return await this._api.create(e)}async update(e,a){return await this._api.update(e,a)}async updateDomain(e,a){return await this._api.updateDomain(e,a)}async getAll(e){return await this._api.getAll(e)}};Q=_e([ee(),fe(0,ae(U))],Q);const te=se("tenants-store",()=>{const e=le.resolve(Q),a=M({data:{props:[],total:0},isLoading:!1,btnLoading:!1,error:""}),t=M({limit:10,filter:{}});async function s(){a.isLoading=!0;const l=await e.getAll({page:t.page,limit:t.limit,filter:t.filter});l&&l.data&&l.status==="success"&&(a.data.props=l.data.props,a.data.total=l.data.total,a.isLoading=!1)}async function n(l){return await e.create(l)}async function m(l,w){return await e.update(l,w)}async function p(l,w){return await e.updateDomain(l,w)}return{getAll:s,create:n,update:m,updateDomain:p,state:a,setStateFilter:t}}),ge=K({__name:"ButtonDefault",props:{bgColor:{},hoverBgColor:{},textColor:{},border:{},isLoading:{type:Boolean}},setup(e){return(a,t)=>{const s=v("a-button");return y(),V(s,{disabled:a.isLoading,class:Y(`flex items-center justify-center gap-2 border-none ${a.bgColor} ${a.textColor} ${a.hoverBgColor}`),shape:a.border?a.border:"default",size:"large"},{icon:d(()=>[H(a.$slots,"icon")]),default:d(()=>[a.isLoading?(y(),j(X,{key:0},[o($(I),{icon:"mdi-loading",class:"animate-spin"}),t[0]||(t[0]=P(" ກຳລັງໂຫລດ... "))],64)):H(a.$slots,"text",{key:1})]),_:3},8,["disabled","class","shape"])}}}),ve=()=>{const{t:e,locale:a}=R(),t=g(0),s=B(()=>({name:[{required:!0,message:e("validation.tenants.name")}],schema_name:[{required:!0,message:e("validation.tenants.schema_name")}],domain:[{required:!0,message:e("validation.tenants.domain_name"),trigger:"blur"}]}));return Z(a,()=>{t.value+=1}),{schema:s,schemaKey:t}},he={class:"flex text-xl font-bold"},be={key:0,class:"text-red-500"},ye={key:1,class:"text-red-500"},we={key:0},W=K({__name:"FormTenantsView",setup(e,{expose:a}){const{schema:t,schemaKey:s}=ve(),{create:n,update:m,getAll:p}=te(),l=g(!1),w=g(null),b=g(!1),S=g(!1),L=g(),A=M({}),D={id:"",name:"",schema_name:"",domain:""},u=g({...D}),C=async()=>{try{await L.value.validate(),S.value=!0,b.value?(await m(u.value,Number(u.value.id)),F.success({message:i("messages.success"),description:i("messages.update")}),l.value=!1,await p()):(await n(u.value),F.success({message:i("messages.success"),description:i("messages.description")}),l.value=!1,await p()),T()}catch(c){if(l.value=!0,c.response&&c.response.data){const _=c.response.data||{};Object.keys(_).forEach(h=>{A[h]=Array(_[h])?_[h][0]:""})}}finally{S.value=!1}},T=()=>{u.value={...D},b.value=!1},r=g("material-symbols-light:table-rows");a({open:l,item:w,isEditMode:b}),Z(w,c=>{c&&(u.value={...c,domain:c.domain.domain_url},b.value=!0,l.value=!0)});const{t:i}=R(),k=B(()=>({name:i("placeholder.tenants.name"),schema_name:i("placeholder.tenants.schema_name"),domain_name:i("placeholder.tenants.domain")}));return(c,_)=>{const h=v("a-input"),E=v("a-form-item"),z=v("a-form"),O=v("a-modal");return y(),V(O,{open:l.value,"onUpdate:open":_[3]||(_[3]=f=>l.value=f),title:""},{footer:d(()=>[o(ge,{disabled:S.value||b.value,isLoading:S.value,bgColor:"bg-black w-full flex justify-center font-bold",textColor:"text-white",onClick:C},{text:d(()=>[S.value?q("",!0):(y(),j("span",we,x(b.value?c.$t("tenants.edit"):c.$t("tenants.add")),1))]),_:1},8,["disabled","isLoading"])]),default:d(()=>[N("div",he,[o($(I),{icon:r.value,class:"mr-2 mt-1 bg-gray-200 rounded-md"},null,8,["icon"]),N("p",null,x(b.value?c.$t("tenants.form_edit"):c.$t("tenants.form_add")),1)]),(y(),V(z,{layout:"vertical",ref_key:"form",ref:L,rules:$(t),key:$(s),model:u.value},{default:d(()=>[o(E,{class:"form-item-centered",label:c.$t("tenants.table_field.name"),name:"name"},{default:d(()=>[o(h,{placeholder:k.value.name,value:u.value.name,"onUpdate:value":_[0]||(_[0]=f=>u.value.name=f)},null,8,["placeholder","value"])]),_:1},8,["label"]),o(E,{class:"form-item-centered",label:c.$t("tenants.table_field.schema_name"),name:"schema_name"},{default:d(()=>{var f;return[o(h,{placeholder:k.value.schema_name,value:u.value.schema_name,"onUpdate:value":_[1]||(_[1]=G=>u.value.schema_name=G),class:Y({"ring-1 ring-red-500 mb-1":A.schema_name})},null,8,["placeholder","value","class"]),A.schema_name&&(((f=u.value.schema_name)==null?void 0:f.length)||0)>62?(y(),j("span",be,x(c.$t("validation.tenants.length")),1)):A.schema_name?(y(),j("span",ye,x(c.$t("validation.tenants.exists")),1)):q("",!0)]}),_:1},8,["label"]),o(E,{class:"form-item-centered",label:c.$t("tenants.table_field.domain"),name:"domain"},{default:d(()=>[o(h,{placeholder:k.value.domain_name,value:u.value.domain,"onUpdate:value":_[2]||(_[2]=f=>u.value.domain=f)},null,8,["placeholder","value"])]),_:1},8,["label"])]),_:1},8,["rules","model"]))]),_:1},8,["open"])}}}),Ce=e=>[{title:e("tenants.table_field.domain"),dataIndex:["domain","domain_url"]},{title:e("tenants.table_field.name"),dataIndex:"name"},{title:e("tenants.table_field.schema_name"),dataIndex:"schema_name"},{title:e("tenants.table_field.created_at"),dataIndex:"created_on"},{title:e("tenants.table_field.more"),dataIndex:"actions",align:"center"}],$e={class:"text-base font-bold text-blue-500"},xe={key:0,class:"flex items-center justify-center gap-2"},je=K({__name:"ListTenantsView",props:{searchQuery:{}},setup(e){const a=g(),t=g(),{getAll:s,state:n,setStateFilter:m}=te(),p=()=>{a.value&&(a.value.open=!0,a.value.isEditMode=!1,a.value.item=null)},l=r=>{const i=n.data.props.find(k=>k.id===r.id);i&&t.value&&(t.value.item=i,t.value.isEditMode=!0,t.value.open=!0)},w=r=>{n.data.props=n.data.props.filter(i=>i.id!==r),F.success({message:C("popconfirm.message_success.title"),description:C("popconfirm.message_success.messages")})},b=()=>{F.error({message:C("popconfirm.message_cancel.title"),description:C("popconfirm.message_cancel.messages")})},S=B(()=>({items_per_page:C("pagination.items_per_page")})),L=g({total:n.data.total,pageSize:m.limit,current:m.page,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],locale:S,onChange:A});async function A(r,i){L.value.current=r,L.value.pageSize=i,m.page=r,m.limit=i,await s()}ne(async()=>{await s(),L.value.total=n.data.total,console.log("data",n.data.props)});const D=e,u=B(()=>{if(!D.searchQuery)return n.data.props;const r=D.searchQuery.toLowerCase();return n.data.props.filter(i=>String(i.name).toLowerCase().includes(r)||String(i.domain).toLowerCase().includes(r))}),{t:C}=R(),T=B(()=>Ce(C));return(r,i)=>{const k=v("a-button"),c=v("a-flex"),_=v("a-divider"),h=v("a-tooltip"),E=v("a-popconfirm"),z=v("a-table");return y(),j(X,null,[o(c,{justify:"space-between",align:"flex-start"},{default:d(()=>[N("p",$e,[o($(re)),P(" "+x(r.$t("tenants.label_list")),1)]),o(k,{type:"primary",onClick:p},{default:d(()=>[P(x(r.$t("tenants.add")),1)]),_:1})]),_:1}),o(_,{style:{"margin-top":"10px"}}),o(z,{scroll:{x:!0},class:"whitespace-nowrap",columns:T.value,dataSource:u.value,pagination:L.value,loading:$(n).isLoading,"row-key":O=>O.id},{bodyCell:d(({column:O,record:f})=>[O.dataIndex==="actions"?(y(),j("div",xe,[o(h,null,{title:d(()=>[P(x(r.$t("tenants.edit")),1)]),default:d(()=>[o(J,{bgColor:"bg-white ",textColor:"text-blue-700",onClick:()=>l(f)},{icon:d(()=>[o($(I),{icon:"solar-pen-bold",width:"18"})]),_:2},1032,["onClick"])]),_:2},1024),o(h,null,{title:d(()=>[P(x(r.$t("tenants.delete")),1)]),default:d(()=>[o(J,{bgColor:"bg-white hover:text-red-600",textColor:"text-red-600"},{icon:d(()=>[o(E,{title:r.$t("popconfirm.delete.messages"),"ok-text":r.$t("popconfirm.delete.okay"),"cancel-text":r.$t("popconfirm.delete.cancel"),onConfirm:G=>w(f.id),onCancel:b,class:"text-red-600",disabled:f.schema_name==="public"},{default:d(()=>[o($(I),{icon:"solar-trash-bin-2-bold",width:"18"})]),_:2},1032,["title","ok-text","cancel-text","onConfirm","disabled"])]),_:2},1024)]),_:2},1024)])):q("",!0)]),_:1},8,["columns","dataSource","pagination","loading","row-key"]),o(W,{ref_key:"modalAdd",ref:a},null,512),o(W,{ref_key:"modalEdit",ref:t},null,512)],64)}}});export{je as default};
